{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useLayoutEffect, useEffect, useCallback, useState, useRef } from \"react\";\nimport { GiftedChat } from 'react-native-gifted-chat';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport { collection, doc, addDoc, query, where, getDocs, orderBy, onSnapshot, push, ref } from 'firebase/firestore';\nimport { signOut } from 'firebase/auth';\nimport { auth, database } from \"../firebase\";\nimport { useNavigation } from '@react-navigation/native';\nimport GradientBackground from \"../Components/GradientBackground\";\nimport BackButton from \"../Components/BackButton\";\nimport { v4 as uuidv4 } from 'uuid';\nimport * as Notifications from 'expo-notifications';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function Chat(props) {\n  var navigation = useNavigation();\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    messages = _useState2[0],\n    setMessages = _useState2[1];\n  var traveler1 = props.route.params.user;\n  var traveler = props.route.params.loggeduser;\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    chatRoomDocRef = _useState4[0],\n    setChatRoomDocRef = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    shouldRender = _useState6[0],\n    setShouldRender = _useState6[1];\n  console.log('im the logged user', traveler.Picture);\n  console.log('im the chosen one!', traveler1.Picture);\n  var onSignOut = function onSignOut() {\n    signOut(auth).catch(function (error) {\n      return console.log(error);\n    });\n  };\n  useLayoutEffect(function () {\n    navigation.setOptions({\n      headerRight: function headerRight() {\n        return _jsx(TouchableOpacity, {\n          style: {\n            marginRight: 10\n          },\n          onPress: onSignOut,\n          children: _jsx(Text, {\n            children: \" Hi\"\n          })\n        });\n      }\n    });\n  }, [navigation]);\n  var createChatRoom = function () {\n    var _ref = _asyncToGenerator(function* () {\n      var sortedUsers = [traveler.traveler_id, traveler1.traveler_id].sort();\n      var chatRoomQuery = query(collection(database, 'chat_rooms'), where('users', '==', sortedUsers));\n      var chatRoomQuerySnapshot = yield getDocs(chatRoomQuery);\n      if (chatRoomQuerySnapshot.size !== 0) {\n        var existingChatRoomRef = chatRoomQuerySnapshot.docs[0].ref;\n        setChatRoomDocRef(chatRoomQuerySnapshot.docs[0].ref);\n        console.log('Chat room exists');\n        var messagesRef = collection(database, 'chat_rooms', existingChatRoomRef.id, 'messages');\n        var q = query(messagesRef, orderBy('createdAt', 'desc'));\n        var unsubscribe = onSnapshot(q, function (querySnapshot) {\n          var messages = querySnapshot.docs.map(function (doc) {\n            var data = doc.data();\n            return {\n              _id: uuidv4(),\n              createdAt: data.createdAt.toDate(),\n              text: data.text,\n              user: data.user\n            };\n          });\n          setMessages(messages);\n          setShouldRender(false);\n        });\n        return false;\n      } else {\n        var newChatRoomDocRef = yield addDoc(collection(database, 'chat_rooms'), {\n          users: sortedUsers,\n          messages: []\n        });\n        setChatRoomDocRef(newChatRoomDocRef);\n        console.log('Chat room created');\n        return true;\n      }\n    });\n    return function createChatRoom() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  useLayoutEffect(function () {\n    var getMessages = function () {\n      var _ref2 = _asyncToGenerator(function* () {\n        var isNewChatRoom = yield createChatRoom();\n        if (!isNewChatRoom) {\n          var messagesRef = collection(database, 'chat_rooms', chatRoomDocRef.id, 'messages');\n          var q = query(messagesRef, orderBy('createdAt', 'desc'));\n          var unsubscribe = onSnapshot(q, function (querySnapshot) {\n            var messages = querySnapshot.docs.map(function (doc) {\n              var data = doc.data();\n              return {\n                _id: uuidv4(),\n                createdAt: data.createdAt.toDate(),\n                text: data.text,\n                user: data.user\n              };\n            });\n            setMessages(messages);\n            setShouldRender(false);\n          });\n          return function () {\n            unsubscribe();\n          };\n        }\n      });\n      return function getMessages() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    getMessages();\n  }, [traveler, traveler1]);\n  var _onSend = useCallback(_asyncToGenerator(function* () {\n    var newMessages = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    var messagesRef = chatRoomDocRef ? collection(database, \"chat_rooms/\" + chatRoomDocRef.id + \"/messages\") : null;\n    if (messagesRef) {\n      var promises = newMessages.map(function (message) {\n        var createdAt = new Date();\n        var messageData = {\n          _id: uuidv4(),\n          text: message.text,\n          createdAt: createdAt,\n          user: {\n            _id: traveler.traveler_id,\n            avatar: traveler.Picture\n          }\n        };\n        setMessages(function (previousMessages) {\n          return GiftedChat.append(previousMessages, messageData);\n        });\n        handlePushNotification(messageData, traveler.token);\n        console.log(\"*********\", traveler);\n        return addDoc(messagesRef, messageData);\n      });\n      Promise.all(promises).then(function () {\n        console.log('Messages sent');\n      }).catch(function (error) {\n        console.error(error);\n      });\n    }\n  }), [traveler, traveler1, chatRoomDocRef]);\n  var handlePushNotification = function () {\n    var _ref4 = _asyncToGenerator(function* (message, recipientToken) {\n      var notification = {\n        title: traveler.first_name + \" \" + traveler.last_name + \" \",\n        body: message.text,\n        data: {\n          chatRoomDocRefId: chatRoomDocRef.id\n        },\n        sound: 'default'\n      };\n      yield Notifications.scheduleNotificationAsync({\n        content: notification,\n        to: recipientToken,\n        trigger: null\n      });\n    });\n    return function handlePushNotification(_x, _x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  return _jsx(GradientBackground, {\n    children: _jsxs(View, {\n      style: styles.container,\n      children: [_jsxs(View, {\n        style: styles.row,\n        children: [_jsx(View, {\n          style: styles.back,\n          children: _jsx(BackButton, {})\n        }), _jsx(View, {\n          style: styles.user,\n          children: _jsx(Image, {\n            style: styles.img,\n            source: {\n              uri: traveler1.Picture\n            }\n          })\n        }), _jsx(View, {\n          style: styles.user,\n          children: _jsxs(Text, {\n            style: styles.text,\n            children: [traveler1.first_name, \" \", traveler1.last_name, \" \"]\n          })\n        })]\n      }), messages && _jsx(GiftedChat, {\n        isTyping: true,\n        showAvatarForEveryMessage: true,\n        messages: messages,\n        onSend: function onSend(messages) {\n          return _onSend(messages);\n        },\n        user: {\n          _id: traveler.traveler_id,\n          avatar: traveler.Picture\n        }\n      })]\n    })\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    marginBottom: 30\n  },\n  back: {\n    paddingTop: 30,\n    marginLeft: 20\n  },\n  img: {\n    height: 40,\n    width: 40,\n    borderRadius: 20,\n    alignItems: 'center',\n    justifyContent: 'center',\n    marginRight: 10\n  },\n  text: {\n    fontSize: 16,\n    top: 0,\n    fontWeight: 'bold',\n    fontSize: 25\n  },\n  row: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    backgroundColor: 'white',\n    width: '100%'\n  },\n  user: {\n    left: 20,\n    top: 20\n  }\n});","map":{"version":3,"names":["React","useLayoutEffect","useEffect","useCallback","useState","useRef","GiftedChat","StyleSheet","Text","View","TouchableOpacity","Image","collection","doc","addDoc","query","where","getDocs","orderBy","onSnapshot","push","ref","signOut","auth","database","useNavigation","GradientBackground","BackButton","v4","uuidv4","Notifications","jsx","_jsx","jsxs","_jsxs","Chat","props","navigation","_useState","_useState2","_slicedToArray","messages","setMessages","traveler1","route","params","user","traveler","loggeduser","_useState3","_useState4","chatRoomDocRef","setChatRoomDocRef","_useState5","_useState6","shouldRender","setShouldRender","console","log","Picture","onSignOut","catch","error","setOptions","headerRight","style","marginRight","onPress","children","createChatRoom","_ref","_asyncToGenerator","sortedUsers","traveler_id","sort","chatRoomQuery","chatRoomQuerySnapshot","size","existingChatRoomRef","docs","messagesRef","id","q","unsubscribe","querySnapshot","map","data","_id","createdAt","toDate","text","newChatRoomDocRef","users","apply","arguments","getMessages","_ref2","isNewChatRoom","onSend","newMessages","length","undefined","promises","message","Date","messageData","avatar","previousMessages","append","handlePushNotification","token","Promise","all","then","_ref4","recipientToken","notification","title","first_name","last_name","body","chatRoomDocRefId","sound","scheduleNotificationAsync","content","to","trigger","_x","_x2","styles","container","row","back","img","source","uri","isTyping","showAvatarForEveryMessage","create","flex","marginBottom","paddingTop","marginLeft","height","width","borderRadius","alignItems","justifyContent","fontSize","top","fontWeight","flexDirection","backgroundColor","left"],"sources":["C:/Users/97250/Desktop/פרויקט גמר/roadranger_1/client/travelersSide/Screens/Chat.jsx"],"sourcesContent":["import React, { useLayoutEffect, useEffect, useCallback, useState, useRef } from \"react\";\r\nimport { GiftedChat } from 'react-native-gifted-chat'\r\nimport { StyleSheet, Text, View, TouchableOpacity, Image } from 'react-native';\r\nimport { collection, doc, addDoc, query, where, getDocs, orderBy, onSnapshot, push, ref } from 'firebase/firestore';\r\nimport { signOut } from 'firebase/auth'\r\nimport { auth, database } from '../firebase'\r\nimport { useNavigation } from '@react-navigation/native'\r\nimport GradientBackground from '../Components/GradientBackground';\r\nimport BackButton from \"../Components/BackButton\";\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport * as Notifications from 'expo-notifications';\r\n\r\nexport default function Chat(props) {\r\n\r\n    const navigation = useNavigation();\r\n    const [messages, setMessages] = useState([]);\r\n    const traveler1 = props.route.params.user;\r\n    const traveler = props.route.params.loggeduser;\r\n    const [chatRoomDocRef, setChatRoomDocRef] = useState('')\r\n    const [shouldRender, setShouldRender] = useState(false); // add state variable\r\n\r\n\r\n    console.log('im the logged user', traveler.Picture);\r\n    console.log('im the chosen one!', traveler1.Picture);\r\n\r\n    const onSignOut = () => {\r\n        signOut(auth).catch(error => console.log(error));\r\n    };\r\n\r\n    useLayoutEffect(() => {\r\n        navigation.setOptions({\r\n            headerRight: () => (\r\n                <TouchableOpacity style={{ marginRight: 10 }} onPress={onSignOut}>\r\n                    <Text> Hi</Text>\r\n                </TouchableOpacity>\r\n            )\r\n        });\r\n    }, [navigation]);\r\n\r\n\r\n\r\n    const createChatRoom = async () => {\r\n        const sortedUsers = [traveler.traveler_id, traveler1.traveler_id].sort();\r\n        const chatRoomQuery = query(collection(database, 'chat_rooms'), where('users', '==', sortedUsers));\r\n        const chatRoomQuerySnapshot = await getDocs(chatRoomQuery);\r\n        if (chatRoomQuerySnapshot.size !== 0) {\r\n            const existingChatRoomRef = chatRoomQuerySnapshot.docs[0].ref;\r\n            setChatRoomDocRef(chatRoomQuerySnapshot.docs[0].ref);\r\n            console.log('Chat room exists');\r\n            const messagesRef = collection(database, 'chat_rooms', existingChatRoomRef.id, 'messages');\r\n            const q = query(messagesRef, orderBy('createdAt', 'desc'));\r\n            const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n                const messages = querySnapshot.docs.map(doc => {\r\n                    const data = doc.data();\r\n                    return {\r\n                        _id: uuidv4(),\r\n                        createdAt: data.createdAt.toDate(),\r\n                        text: data.text,\r\n                        user: data.user\r\n                    };\r\n                });\r\n                // console.log('Fetched messages:', messages); // add this line\r\n                setMessages(messages);\r\n                setShouldRender(false); // update state variable to trigger re-render\r\n            });\r\n            return false; // indicate that chat room already exists\r\n        } else {\r\n            const newChatRoomDocRef = await addDoc(collection(database, 'chat_rooms'), {\r\n                users: sortedUsers,\r\n                messages: []\r\n            });\r\n            setChatRoomDocRef(newChatRoomDocRef);\r\n            console.log('Chat room created');\r\n            return true; // indicate that new chat room was created\r\n        }\r\n    };\r\n\r\n    useLayoutEffect(() => {\r\n        const getMessages = async () => {\r\n            // Call createChatRoom() to make sure chat room exists\r\n            const isNewChatRoom = await createChatRoom();\r\n            if (!isNewChatRoom) {\r\n                // If a new chat room was created, do any necessary setup here\r\n                const messagesRef = collection(database, 'chat_rooms', chatRoomDocRef.id, 'messages');\r\n                const q = query(messagesRef, orderBy('createdAt', 'desc'));\r\n                const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n                    const messages = querySnapshot.docs.map(doc => {\r\n                        const data = doc.data();\r\n                        return {\r\n                            _id: uuidv4(),\r\n                            createdAt: data.createdAt.toDate(),\r\n                            text: data.text,\r\n                            user: data.user\r\n                        };\r\n                    });\r\n                    // console.log('Fetched messages:', messages); // add this line\r\n                    setMessages(messages);\r\n                    setShouldRender(false); // update state variable to trigger re-render\r\n                });\r\n\r\n                return () => {\r\n                    unsubscribe();\r\n                };\r\n            }\r\n        };\r\n\r\n        getMessages();\r\n    }, [traveler, traveler1]);\r\n\r\n\r\n    const onSend = useCallback(async (newMessages = []) => {\r\n        const messagesRef = chatRoomDocRef ? collection(database, `chat_rooms/${chatRoomDocRef.id}/messages`) : null;\r\n        if (messagesRef) {\r\n          const promises = newMessages.map((message) => {\r\n            const createdAt = new Date();\r\n            const messageData = {\r\n              _id: uuidv4(), // add the generated ID to the message object\r\n              text: message.text,\r\n              createdAt: createdAt,\r\n              user: {\r\n                _id: traveler.traveler_id,\r\n                avatar: traveler.Picture\r\n              }\r\n            };\r\n            setMessages((previousMessages) => GiftedChat.append(previousMessages, messageData));\r\n            handlePushNotification(messageData, traveler.token); // send push notification to the recipient\r\n            console.log(\"*********\", traveler)\r\n            return addDoc(messagesRef, messageData);\r\n          });\r\n      \r\n          Promise.all(promises)\r\n            .then(() => {\r\n              console.log('Messages sent');\r\n            })\r\n            .catch((error) => {\r\n              console.error(error);\r\n            });\r\n        }\r\n      }, [traveler, traveler1, chatRoomDocRef]);\r\n      \r\n    const handlePushNotification = async (message, recipientToken) => {\r\n        // Construct the message payload\r\n        const notification = {\r\n          title: `${traveler.first_name} ${traveler.last_name} `,\r\n          body: message.text,\r\n          data: { chatRoomDocRefId: chatRoomDocRef.id },\r\n          sound: 'default',\r\n        };\r\n      \r\n        // Send the notification to the recipient\r\n        await Notifications.scheduleNotificationAsync({\r\n          content: notification,\r\n          to: recipientToken,\r\n          trigger: null,\r\n        });\r\n      };\r\n      \r\n    return (\r\n        <GradientBackground>\r\n            <View style={styles.container}>\r\n                <View style={styles.row}>\r\n                    <View style={styles.back}>\r\n                        <BackButton />\r\n                    </View >\r\n                    <View style={styles.user}>\r\n                        <Image style={styles.img} source={{ uri: traveler1.Picture }} />\r\n                    </View>\r\n                    <View style={styles.user}>\r\n                        <Text style={styles.text}>{traveler1.first_name} {traveler1.last_name} </Text>\r\n                    </View>\r\n                </View>\r\n                {messages && (\r\n                    <GiftedChat\r\n                        isTyping={true}\r\n                        showAvatarForEveryMessage={true}\r\n                        messages={messages}\r\n                        onSend={messages => onSend(messages)}\r\n                        user={{\r\n                            _id: traveler.traveler_id,\r\n                            avatar: traveler.Picture\r\n                        }}\r\n                    />\r\n                )}\r\n\r\n            </View>\r\n        </GradientBackground>\r\n    )\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n        flex: 1,\r\n\r\n        // backgroundColor: '#fff',\r\n        // marginTop: 40,\r\n        marginBottom: 30\r\n    },\r\n    back: {\r\n        paddingTop: 30,\r\n        marginLeft: 20\r\n    },\r\n    img: {\r\n        height: 40,\r\n        width: 40,\r\n        borderRadius: 20,\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        marginRight: 10,\r\n    },\r\n    text: {\r\n        fontSize: 16,\r\n        top: 0,\r\n        fontWeight: 'bold',\r\n        fontSize: 25\r\n\r\n    },\r\n    row: {\r\n\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        backgroundColor: 'white',\r\n        width: '100%',\r\n        // margin: 5\r\n    },\r\n    user: {\r\n        left: 20,\r\n        top: 20,\r\n\r\n\r\n    }\r\n})\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}